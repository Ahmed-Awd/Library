# توثيق قاعدة البيانات

- [Roles & Permissions](#roles-permissions)
- [Packages](#packages)
- [Attachments](#attachments)
- [Settings](#settings)
- [Sms Verfication](#sms-auth)
- [Users](#users)
- [Orders](#orders)
- [Stores](#stores)

<a name="roles-permissions"></a>
## Roles & Permissions

![Roles & Permissions](/doc-files/v1.0/db/roles-permissions.png)

الجداول الخاصة بالرتب والصلاحيات جاهزة من spatie/laravel-permission يمكن معرفة طريقة التعامل معها بالرجوع [للتوثيق الخاص بها](https://spatie.be/docs/laravel-permission/v4/introduction).

<a name="packages"></a>
## Packages

![Packages](/doc-files/v1.0/db/packages.png)

الجداول المتعلقة بالباقات،، جدول packages تخزن فيه بيانات الباقة الباقة لها سعر وقيمة موضحة كالآتي:

* السعر - price: هو السعر الذي يتم شراء الباقة به، حاليا لا يوجد شراء من داخل التطبيق فيستخدم السعر للعرض فقط.
* القيمة - value: هي القيمة التي سيتم اضافتها للرصيد عند الشحن.

ويرتبط بكل باقة عدد من ال codes حيث يتم الشحن باستخدام الكود المخزن، وبعد الشحن يرتبط الكود 

الـ type الموجود في جدول الباقات يوضح هل الباقة تعرض في تطبيق الزبون ام في تطبيق السائق،

لتفاصيل اكثر يرجى زيارة [توثيق الباقات](/{{route}}/{{version}}/packages).

<a name="attachments"></a>
## Attachments

![Attachments](/doc-files/v1.0/db/attachments.png)

المرفقات حاليا تستخدم لتخزين الصور الخاصة ببيانات السائق،، لكل مرفق وصف يوضح نوع المرفق، والعلاقة نوعها [Morph Relation](https://laravel.com/docs/8.x/eloquent-relationships#polymorphic-relationships) بحيث يمكن التوسع لاحقا وربط المرفقات بامور اخرى مثل المتجر.

<a name="settings"></a>
## Settings

![Settings](/doc-files/v1.0/db/settings.png)

الجدول المخصص لتخزين الاعدادات العامة للموقع القائمة التالية توضح وظيفة كل عمود:

* key => المفتاح المميز للخيار، باستخدام هذا المفتاح يمكن استدعاؤه داخل الكود بشكل مقروء دون التعامل مع الـ id
* name => اسم العرض الذي سيتم عرضه في لوحة التحكم للخيار.
* value => قيمة الخيار، يمكن تعديلها من لوحة التحكم.
* default => القيمة الأصلية/الافتراضية للخيار، الهدف منها امكانية عمل Reset لخيارات الموقع بحيث ترجع الاعدادات الافتراضية.
* is_price => توضح اذا كان الخيار عبارة عن سعر أم لا، في حال كان الخيار عبارة عن سعر يتم التعامل معه على انه بأصغر وحدة سعرية (cent مثلا) فيتم اجراء عمليات الضرب والقسمة على 100 قبل التعامل معه في التخزين او القراءة.

<a name="sms-auth"></a>
## Sms Verification

![Sms Verification](/doc-files/v1.0/db/sms-auth.png)

هذا الجدول يخزن الكود الخاص بالتحقق من رقم الهاتف المستخدم عند تسجيل سائق جديد، يتم تخزين عدد محاولات الدخول الخاطئة number_of_tries ليتم حذف الكود في حال تم ادخاله بشكل خاطئ اكثر من 3 مرات منعا للتخمين.

<a name="users"></a>
## Users

![Users](/doc-files/v1.0/db/users.png)

الجدول الخاص بالمستخدمين، يتم تخزين جميع انواع المستخدمين في هذا الجدول، ويتم التفريق بينهم باستخدام Role المرتبطة بكل مستخدم، القائمة التالية
توضح بعض الخصائص لهذا الجدول:

| الخاصية | الوصف |
| --- | --- |
| balance | الرصيد الخاص بالمستخدم |
| reserved_balance | الرصيد المحجوز للمستخدم، يتم نقل عمولة الطلب من الرصيد الى الرصيد المحجوز في حال تم انشاء طلب جديد ولم يتم تسليمه بعد |
| is_disabled | في حال كانت قيمتها 1، يتم تعطيل المستخدم،، السائق يكون معطلا افتراضيا عند التسجيل |
| is_available | توضح حالة السائق (متاح لاستقبال الطلبات / غير متاح لاستقبال الطلبات)ِ |
| two_factor_* | متعلقة بميزة 2FA غير مفعلة حاليا، ويمكن حذفها في حال لن يتم تفعيل الميزة |
| current_team_id | متعلق بميزة الفرق،، غير مستخدم ويمكن حذفه |
| charge_fail_attempts | عدد المحاولات الفاشلة للشحن (ادخال كود خاطئ)، في حال تم الوصول ل 3 محاولات يتم منعه من الشحن لمدة ساعة |
| last_fail_charge | الوقت الذي تم منع المستخدم فيه من الشحن، في حال مر اكثر من ساعة يتم تصفير عدد المحاولات |
| mobile_verified_at | التاريخ الذي تم تفعيل رقم الهاتف فيه،، في حال عدم وجود تاريخ يكون الرقم غير مفعل  |


<a name="orders"></a>
## Orders

![Orders](/doc-files/v1.0/db/orders.png)

جدول يخزن بيانات الطلب، ويرتبط بـ order statuses الموضحة في [صفحة حالات الطلب](/{{route}}/{{version}}/order-states).


<a name="stores"></a>
## Stores

![Stores](/doc-files/v1.0/db/stores.png)

تخزن بيانات المتجر واعداداته، الانواع types تمثل نوع النشاط للمتجر (مطاعم، صيدليات..الخ).